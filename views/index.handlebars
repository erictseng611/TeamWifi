<html>

<head>
	<!-- Compiled and minified JavaScript -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>

	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<!--<script src="https://maps.google.com/maps/api/js?key=AIzaSyBQIoDF-NYDXiovnOeBtRBzqzr7S2VQv8E" type="text/javascript"></script> -->
	<script src="./js/myscript.js" type="text/javascript"></script>
	<script src="//speedof.me/api/api.js" type="text/javascript"></script>

	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"/>
	<link rel="stylesheet" type="text/css" href="./css/style.css">

	<!-- Leaflet Locate Control -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.css" />

	<script src="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>

	<title>Team Wifi</title>

</head>


<body>
	<div id="container">

		<div class="card" id="key">
			<div class="card-header">Key</div>
			<div class="card-block">
				<blockquote class="card-blockquote">
					<div class="alert alert-danger" role="alert">Slow</div>
					<div class="alert alert-warning" role="alert">Average</div>
					<div class="alert alert-success" role="alert">Great</div>
				</blockquote>
			</div>
		</div>


		<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Wifi Speed</h4>
					</div>
					<div class="modal-body">
						<form>

							<div class="form-group">
					      <label for="sel1">Select Wifi Network</label>
					      <select class="form-control" name="wifi"id="sel1">
					      	<option value="UCSD-PROTECTED" >UCSD-PROTECTED</option>
							    <option value="UCSD-GUEST" >UCSD-GUEST</option>
							    <option value="eduroam" >eduroam</option>
							    <option value="UCSD-DEVICE" >UCSD-DEVICE</option>
							    <option value="RESNET-MUIR-E" >RESNET-MUIR-E</option>
							    <option value="RESNET-MUIR" >RESNET-MUIR</option>
							    <option value="RESNET-SIXTH-E" >RESNET-SIXTH-E</option>
							    <option value="RESNET-SIXTH" >RESNET-SIXTH</option>
							    <option value="RESNET-ERC-E" >RESNET-ERC-E</option>
							    <option value="RESNET-ERC" >RESNET-ERC</option>
							    <option value="RESNET-MARSHALL-E" >RESNET-MARSHALL-E</option>
							    <option value="RESNET-MARSHALL" >RESNET-MARSHALL</option>
							    <option value="RESNET-REVELLE-E" >RESNET-REVELLE-E</option>
							    <option value="RESNET-REVELLE" >RESNET-REVELLE</option>
							    <option value="Private/Other Network" >Private/Other Network</option>
					      </select>
					    

								<label for="comment">Comment:</label>
								<input type="text" class="form-control" id="pwd" name="comments" placeholder="(Optional)">

								<br>

								<p>Personal Speed Rating:</p>

								<div class="btn-group" role="group" aria-label="Basic example">
									<button type="button" class="alert alert-danger">Slow</button>
									<button type="button" class="alert alert-warning">Average</button>
									<button type="button" class="alert alert-success">Great</button>
								</div>

								<pre id="result"></pre>

								<script type="text/javascript">
									var x = document.getElementById("result").textContent;
									var y = JSON.parse(x);

									console.log(y);
								</script>


							</div>

							<button type="button submit" class="btn btn-default" onclick="btnStartClick()">Submit</button>
						</form>


					</div>

					<div class="modal-footer">
						

						<div id="msg"></div>

					</div>
				</div>

			</div>
		</div>


		<!-- Get JSON data from form in modal -->
		<script type="text/javascript">
			$.fn.serializeObject = function()
			{
			    var o = {};
			    var a = this.serializeArray();
			    $.each(a, function() {
			        if (o[this.name] !== undefined) {
			            if (!o[this.name].push) {
			                o[this.name] = [o[this.name]];
			            }
			            o[this.name].push(this.value || '');
			        } else {
			            o[this.name] = this.value || '';
			        }
			    });
			    return o;
			};

			$(function() {
			    $('form').submit(function() {
			        $('#result').text(JSON.stringify($('form').serializeObject()));
			        return false;
			    });
			});
		</script>




		<div id="nav">

			<!-- Example single danger button -->
			<div class="btn-group">
				<button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Menu
				</button>
				<div class="dropdown-menu">
					<a class="dropdown-item" href="./index">Map</a>
					<a class="dropdown-item" href="/history">History</a>
					<a class="dropdown-item" href="/faq">FAQ</a>
					<a class="dropdown-item" href="/settings">Settings</a>
					<div class="dropdown-divider"></div>
					<a class="dropdown-item" href="/">Sign Out</a>
				</div>
			</div>

        </div>

        <div id="wifi">

        	<a href="./wifi.html" class="btn btn-lg btn-info"  role="button" data-toggle="modal" data-target="#myModal">Check Wifi</a>

        </div>

        <div id="map"></div>


		</div>

		<div id="wifi">

			<a href="" class="btn btn-lg btn-info"  role="button" data-toggle="modal" data-target="#myModal">Check Wifi</a>

		</div>

		<div id="map"></div>

		<!-- Leaflet Map and GeoJSON Stuff -->

		<script>

		var map = L.map('map').setView([32.880824, -117.237583], 15);
		mapLink =
		'<a href="https://openstreetmap.org">OpenStreetMap</a>';
		L.tileLayer(
			'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; ' + mapLink + ' Contributors',
				minZoom: 15,
				maxZoom: 18,
			}).addTo(map);

			var currentLat; // Will grab current latitude after user checks location
			var currentLng; // Will grab current longitude after user checks location

			// Current location addon
			var lc = L.control.locate({
				strings: {
					title: "Current Location"
				}
			}).addTo(map);



			// Return coordinates of current locations
			map.locate() /* This will return map so you can do chaining */
        .on('locationfound', function(e){
            currentLat = e.latitude;
            currentLng = e.longitude;

        })
       .on('locationerror', function(e){
            console.log(e);
            alert("Location access denied.");
        });


			{{#each Wifi}}


			var geojsonFeature = {
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [{{Coordinates}}]
				}
			};

			var geoOption;

			var geojsonFeature1 = {
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [-117.237583, 32.880824]
				}
			};

			var geojsonFeature2 = {
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [-117.241821, 32.885320]
				}
			};


			// Poor
			var geojsonMarkerOptions1 = {
				radius: 40,
				fillColor: "#f2dede",
				color: "#000",
				weight: 1,
				opacity: 1,
				fillOpacity: 0.7,
				clickable: false
			};

			// Great
			var geojsonMarkerOptions2 = {
				radius: 40,
				fillColor: "#dff0d8",
				color: "#000",
				weight: 1,
				opacity: 1,
				fillOpacity: 0.7,
				clickable: false
			};

			// Average
			var geojsonMarkerOptions3 = {
				radius: 40,
				fillColor: "#fcf8e3",
				color: "#000",
				weight: 1,
				opacity: 1,
				fillOpacity: 0.7,
				clickable: false
			};

			if("{{Connection}}" == "Great"){
				geoOption = geojsonMarkerOptions2;
			}

			else if("{{Connection}}" == "Average"){
				geoOption = geojsonMarkerOptions3;
			}

			else{
				geoOption = geojsonMarkerOptions1;
			}


			L.geoJson(geojsonFeature, {
				pointToLayer: function (feature, latlng) {
					return L.circleMarker(latlng, geoOption);
				}
			}).addTo(map);

			{{/each}}
			

			var marker1 = L.marker(new L.LatLng(32.880824, -117.237583)).addTo(map);
			marker1.bindPopup("my tooltip text");




			 //Wifi Test API Code

			SomApi.account = "SOM58290e9f87d48"; //your API Key here
			SomApi.domainName = "wifinderucsd.herokuapp.com"; //your domain or sub-domain here
			SomApi.config.sustainTime = 1;
			SomApi.onTestCompleted = onTestCompleted;
			SomApi.onError = onError;

			var msgDiv = document.getElementById("msg");

			function btnStartClick() {
				msgDiv.innerHTML = "<h3>Speed test in progress. Please wait...</h3>";
				SomApi.startTest();


			}

			function onTestCompleted(testResult) {
				msgDiv.innerHTML =
				"<h3>"+
				"Download: " +testResult.download +"Mbps <br/>"+
				"Upload: " +testResult.upload +"Mbps <br/>"+
				"Latency: " +testResult.latency +"ms <br/>"+
				"Jitter: " +testResult.jitter +"ms <br/>"+
				"Test Server: "+testResult.testServer +"<br/>"+
				"IP: " +testResult.ip_address +"<br/>"+
				"Hostname: " +testResult.hostname +"<br/>"+
				"</h3>";

				var speed = testResult.download;

				var newgeojsonFeature = {
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [currentLng, currentLat]
				}
				};

				

				var conn;

				if(speed < 7.86){
					geoOption = geojsonMarkerOptions1;
					conn = "Slow";
				}

				else if(speed > 7.86 && speed < 10){
					geoOption = geojsonMarkerOptions3;
					conn = "Average";
				}

				else{
					geoOption = geojsonMarkerOptions2;
					conn = "Great";
				}

				L.geoJson(newgeojsonFeature, {
					pointToLayer: function (feature, latlng) {
						return L.circleMarker(latlng, geoOption);
					}
				}).addTo(map);

				var x = document.getElementById("result").textContent;
				var y = JSON.parse(x);
				console.log(y);

				var today = new Date();
			var dd = today.getDate();
				var mm = today.getMonth()+1; //January is 0!
				var yyyy = today.getFullYear();

				if(dd<10) {
				    dd='0'+dd;
				} 

				if(mm<10) {
				    mm='0'+mm;
				} 
	 
				today = mm+'/'+dd+'/'+yyyy;

				//console.log(y); 

				var lol = {items: [
			    {Latency: "testResult.latency"},
			    {"Upload": testResult.upload},
			    {"Download": testResult.download},
			    {"Coordinates": [currentLng, currentLat]},
			    {"Wifi-Name": y[0]},
			    {"User-Comments": y[1]},
			    {"Connection": conn},
			    {"Date": today}
				]};

				
				console.log(lol);
				console.log("Shit is working!");


			}

			function onError(error) {
				msgDiv.innerHTML = "Error "+ error.code + ": "+error.message;
			}

			
			</script>


		</div>

		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-87205602-1', 'auto');
		  ga('send', 'pageview');

		</script>
	</body>

	</html>
